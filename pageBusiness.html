<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
</head>
    <style>
    .bar {fill: steelblue;}
    .circle {fill: blue;
      opacity:0.2;
    }
    .button {

      font: 36px;
      color: blue;
      width:100px;
      height:50px;

    }

    .tooltip {
     background-color:#aaa;
     position: absolute;
     padding: 1em;
     left: 20%;
     top: 30%;
     transform: translateX(-50%);
     border-radius: 5px;
     text-align: center;
 }
 .annotations {
  background-color:#aaa;
  position: absolute;
  padding: 1em;
  left: 20%;
  top: 30%;
  transform: translateX(-30%);
  transform: translateY(-30%);
  font:5px;
  border-radius: 5px;
  text-align: center;
}

</style>
<script src='https://d3js.org/d3.v5.min.js'></script>

<body onload='page()'>
  <h1 id="first_page_title">Here is what Tech domain offer:</h1>

	<div id="description1" width="30" height="100" display=inline position=absolute>
  <p id="description">On this page, you can figure out how many courses have the highest score and how many are outsiders
  <br> Hover over the bars to see the exact number of courses scored with this number of stars.</p>

	</div>
  <svg width="700" height="500"></svg>
  <div id="reference">This dataset was obtained from Kaggle  <a href="https://www.kaggle.com/songseungwon/2020-udemy-courses-dataset">https://www.kaggle.com/songseungwon/2020-udemy-courses-dataset</a>
<p>Click on the bars to know more!</p>
  </div>
<button class="button"><a class="button" href="index.html" role="button">To Start</a></button>
<script>

const Topics = ["Tech", "Business", "Finance"];
const color = ["steelblue", "green", "brown"];



async function page(){


  var svg = d3.select("svg").style("z-index", -1);
  var margin = {top: 50, right: 150, bottom: 50, left: 50};
console.log(margin);
  var width = svg.attr("width") - margin.right-margin.left;
  var height = svg.attr("height") - margin.bottom-margin.top;


    var scale_stars = d3.scaleBand().range([0, width]).padding(0.3);
    var scale_y = d3.scaleLinear().range([height, 0]);

    var g = svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      data = await d3.csv("Stars_overall.csv");

        scale_stars.domain(data.map(function(d) { return d.Stars; }));
        scale_y.domain([0, d3.max(data, function(d) { return d.Business; })]);

        var Tech_values = data.map(rec => rec["Tech"])
        var Finance_values = data.map(rec => rec["Finance"])
        var Business_values = data.map(rec => rec["Business"])

    var left_axis = g.call(d3.axisLeft(scale_y))
    .append("text")
    .attr("y", margin.left-30)
    .attr("dy", "-5.1em")
    .attr("text-anchor", "middle")
    .attr("stroke", "black")
    .text("Number of courses");

    var bottom_axis = g.append("g").
    attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(scale_stars).tickValues([1,2,3,4,5]).tickFormat( d3.format(".0f")))
    .append("text")
    .attr("y", margin.bottom-20 )
    .attr("x", width-100 )
    .attr("stroke", "black")
    .attr("text-anchor", "start")
    .text("Stars");

    bar_chart = g.append("g").selectAll(".bar")
         .data(data)
         .enter().append("rect")
         .attr("class", "bar")
         .on("mouseover", onMouseOver)
         .on("mouseout", onMouseOut)
         .attr("x", function(d) { return scale_stars(d.Stars); })
         .attr("y", function(d) { return scale_y(d.Business); })
         .attr("width", scale_stars.bandwidth())
         .attr("height", function(d) { return height - scale_y(d.Business); })
         .attr("id", function(d,i) { return (i); })
         .style("fill", color[1])
         .style("opacity","0.7")
        .on("click", onClick);

var tooltip = d3.selectAll("body")
                  .append("div")
         				 .style("opacity", 0)
         	       .attr("class", "tooltip")
         	       .text("text")
         				 .style("color", "black")
         				 .style("position", "absolute")

    function onMouseOver(d, i) {
        d3.select(this)
          .transition()
          .duration(300)
          .attr('width', scale_stars.bandwidth() + 5)
          .style("opacity",1)


        tooltip.style("opacity", 1)
        .style("left", d3.mouse(this)[0]+20+"px")
        .style("top", d3.mouse(this)[1]+30+"px")
        .style("font-size", "15px")
        .text("Number of courses is" + d.Business);
        ;
    }


    function onMouseOut(d, i) {

        d3.select(this).attr('class', 'bar');
        d3.select(this)
          .transition()
          .duration(300)
          .attr('width', scale_stars.bandwidth())
          .style("opacity",0.7)

      tooltip.style("opacity", 0);

    }

    var annotation = d3.selectAll("body")
                      .append("div")
                     .style("opacity", 1)
                     .attr("class", "annotations")
                     .text("The bars distribution is much more steep than for Tech here")
                     .style("color", "black")

                     .style("position", "absolute")
                     .style("left", 250+"px")
                     .style("top", 250+"px")
                     .style("width", "150px")
                     .style("height", "100px")

 function onClick() {
       var rectangle = d3.select(this).attr("id")
       console.log(rectangle)
       console.log(Tech_values[rectangle])
       tech = Tech_values[rectangle];
       fin = Finance_values[rectangle];
       bus = Business_values[rectangle];
       tooltip.style("opacity", 1)
       .style("left", d3.mouse(this)[0]+20+"px")
       .style("top", d3.mouse(this)[1]+30+"px")
       .style("font-size", "15px")
       .text("Courses in Tech: "+tech + ". Courses in Business: " +bus+". Courses in Finance: "+fin)
       .style("width", "150px")
       .style("height", "100px")              }


  };
</script>
</body>
</html>
