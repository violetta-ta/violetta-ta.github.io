<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
</head>
<style>
        .bar {
            fill: steelblue;}
			.tooltip {
	     background-color:#aaa;
	     position: fixed;
	     padding: 2em;
	     left: 20%;
	     top: 30%;
	     transform: translateX(-50%);
	 }


        }

</style>
<script src='https://d3js.org/d3.v5.min.js'></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
<body onload='init()'>
	<h1 id="first_page_title">Which courses rated best?</h1>

	<div id="description1" width="30" height="100" display=inline position=absolute>
  <p id="description">Here you will see some visualization of the 3 courses domains at Udemy, and can explore which area of courses valued most</p>

	</div>
  <svg width="700" height="500"></svg>
  <div id="reference">This dataset was obtained from Kaggle  <a href="https://www.kaggle.com/songseungwon/2020-udemy-courses-dataset">https://www.kaggle.com/songseungwon/2020-udemy-courses-dataset</a>
	</div>
<a class="button" href="main_page.html" role="button">Next</a>
<script>

async function init() {
// var div = d3.select("body").append("div")
// 		.attr("class", "tooltip")
// 		.style("opacity", 1)
// 		.style("top", 100)
// 		.style("left", 100)
// 		.text("text1")
// 		.style("position", "absolute");


    var svg = d3.select("svg").style("z-index", -1)//.style("margin-top","-63.5%").style("float", "right");
    var margin = {top: 50, right: 150, bottom: 50, left: 50};

    var width = svg.attr("width") - margin.right-margin.left;
    var height = svg.attr("height") - margin.bottom-margin.top;


    var scale_Topics = d3.scaleBand().range([0, width]).padding(0.5);
    var scale_count = d3.scaleLinear().range([height, 0]);

    var g = svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    data = await d3.csv("Stars_overall.csv");

overall_count = {"Tech":0, "Business":0,"Finance":0}

data.forEach(function(d){
	overall_count["Tech"] = overall_count["Tech"] + parseInt(d.Tech,10);
	overall_count["Business"] = overall_count["Business"]+parseInt(d.Business,10);
	overall_count["Finance"] = overall_count["Finance"]+ parseInt(d.Finance,10);
})

console.log(overall_count);

counts = d3.map(overall_count);

console.log(d3.keys(overall_count));

labels = d3.keys(overall_count)

var color = d3.scaleOrdinal().domain(labels).range(["rose", "green", "brown"]);

scale_Topics.domain([0,1,2]);
scale_count.domain([0, 10000]);


    var left_axis = g.call(d3.axisLeft(scale_count))
    .append("text")
    .attr("y", margin.left-30)
    .attr("dy", "-5.1em")
    .attr("text-anchor", "middle")
    .attr("stroke", "black")
    .text("Number of courses");

    var bottom_axis = g.append("g").
    attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(scale_Topics)
		.tickFormat((d, i) => labels[i]))
    .append("text")
    .attr("y", height-275 )
    .attr("x", width-50 )
    .attr("stroke", "black")
    .attr("text-anchor", "start")
    .text("Topics");

		bar_chart = g.append("g").selectAll(".bar")
				 .data(counts.values())
				 .enter().append("rect")
				 .attr("class", "bar")
				 .on("mouseover", onMouseOver)
				 .on("mouseout", onMouseOut)
				 .attr("x", function(d,i) {return scale_Topics(i); })
				 .attr("y", function(d) { return scale_count(d); })
				 .attr("width", scale_Topics.bandwidth())
				 .attr("height", function(d) { return height - scale_count(d); })
				 .attr("id", function(d,i) { return scale_Topics(i); })
				 .style("fill", (function(d,i) { return color(i); }))
				 .style("opacity","0.7")
				 //.selectAll("a").enter().append("a")
				 //.attr("xlink:href", "/Index/pageTech.html");
				 .on("click", function URL() {location.href = '/Index/pageTech.html';});


console.log()

var tooltip = d3.selectAll("body")
         .append("div")
				 .attr("height", 30)
				 .attr("width", 30)
				 .attr("background-color", "red")
	       .style("opacity", 0)
	       .attr("class", "tooltip")
	       .text("text")
				 .style("color", "black")
				 .style("position", "absolute")
				 //.style("display", "absolute")
				 //.attr("top", 50)
				 //.attr("left", 70);



    function onMouseOver(d) {
          d3.select(this)
          .transition()
          .duration(400)
					.attr('width', scale_Topics.bandwidth() + 5)
          .style("opacity","1")

					 svg.append("text")
			        .attr('class', 'tooltip')
							.attr("x", d3.mouse(this)[0]+20+"px")
							.attr("y", d3.mouse(this)[1]+30+"px")
			        .attr("font-size", "15px")
			        .text(d + " courses");

				    tooltip.style("opacity", 1);

    }


    function onMouseOut(d) {
        d3.select(this).attr('class', 'bar');
        d3.select(this)
          .transition()
          .duration(400)
          .attr('width', scale_Topics.bandwidth())
					.style("opacity","0.7");

      tooltip.style("opacity", 0);

        //d3.selectAll('.tooltip')
        //  .remove()
    }

		const annotations = [
				{
						note: {
								label: "As you can see, the biggest number of courses is in Tech and Business domain",
								title: counts["Business"],
								align: "right"
						},
						x: 225,
						y: 450 - (450/counts["Business"]) * counts["Business"],
						dy: -100,
						dx: -100,
						subject: { radius: 50, radiusPadding: 10 },
				},
		];

		const makeAnnotations = d3.annotation()
				.type(d3.annotationLabel)
				.annotations(annotations)

		d3.select("svg")
				.append("g")
				.attr("transform", "translate(50,50)")
				.attr("class", "annotation-group")
				.style("position", "absolute")
				.call(makeAnnotations)


}
</script>
</body>
</html>
